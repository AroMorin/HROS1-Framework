/*! node-app 16-10-2015 */
function setCoreActions(){actionList.stand=2,actionList.sit=4,actionList.sitshtdown=6,actionList.wave=10,actionList.handshake=11,actionList.excite=12,actionList.thanks=13,actionList.superhero=14,actionList.dance=15,actionList.nod=16}function getBatteryVoltLevel(){BatteryLevel=diagnostics.BatteryVoltLevelJS()}var express=require("express"),ffi=require("ffi"),app=express(),http=require("http").Server(app),io=require("socket.io")(http),say=require("say"),LIBLOC="../api_wrapper/apiwrapper",actionList={},BatteryLevel=-1;app.use(express["static"](__dirname+"/www")),app.get("/",function(a,b){b.sendfile("index.html")});var general=ffi.Library(LIBLOC,{InitializeJS:["bool",[]],ServoShutdownJS:["void",[]],ServoStartupJS:["void",[]]});app.get("/options/getname",function(a,b){}),app.get("/diagnostics/initialize",function(a,b){});var actions=ffi.Library(LIBLOC,{PlayActionJS:["int",["int"]]});app.get("/action/call/:name",function(a,b){console.log(a)}),app.get("action/add/:name",function(a,b){console.log(a)}),app.get("action/position/:name:position:server",function(a,b){console.log(a)});var walk=ffi.Library(LIBLOC,{WalkJS:["void",["bool"]],WalkingJS:["void",["int","int"]]});app.get("walk/:onOff",function(a,b){}),app.get("walk/position/:x:y",function(a,b){});var head=ffi.Library(LIBLOC,{});app.get("head/position/:angle:degree",function(a,b){});var diagnostics=ffi.Library(LIBLOC,{CheckServosJS:["int",[]],BatteryVoltLevelJS:["int",[]]});app.get("/diagnostics/check",function(a,b){}),app.get("/diagnostics/battery",function(a,b){});var sensors=ffi.Library(LIBLOC,{});io.on("connection",function(a){console.log("device connected"),setInterval(function(){io.emit("batterylevel",BatteryLevel)},2e3),a.on("initialize",function(){setCoreActions(),general.InitializeJS()&&actions.PlayActionJS(actionList.sit)}),a.on("servoshutdown",function(){general.ServoShutdownJS()}),a.on("servostartup",function(){general.ServoStartupJS()}),a.on("disconnect",function(){console.log("disconnecting"),actions.PlayActionJS(actionList.sit),console.log("disconnected")}),a.on("action",function(a){var b=a.trim();console.log("loading page",b);try{"string"==typeof b&&(b=actionList[b]),actions.PlayActionJS(b),console.log("played page",b)}catch(c){console.log("failed to load page")}}),a.on("walktoggle",function(a){console.log("walk toggle"),"boolean"==typeof a?walk.WalkJS(a):console.log("must be boolean parameter")}),a.on("walking",function(a){"number"==typeof parseInt(a.x)&&"number"==typeof parseInt(a.y)?(console.log(a.x,a.y),walk.WalkingJS(parseInt(a.x),parseInt(a.y))):console.log("must give int x and y coords")}),a.on("headposition",function(a,b){head.MoveHeadByAngleJS(a,b)}),a.on("speech",function(a){say.speak(null,a)})}),http.listen(2114,function(){console.log("listening on port 2114"),setInterval(getBatteryVoltLevel,1e3),setCoreActions(),general.InitializeJS()?(actions.PlayActionJS(actionList.sit),console.log("successful robot init")):console.log("error initializing robot")});